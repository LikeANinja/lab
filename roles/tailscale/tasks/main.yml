- name: Install tailscale from Debian repos (preferred)
  apt:
    update_cache: true
    name: tailscale
    state: present
  register: ts_install
  failed_when: false

- name: Check if tailscaled unit exists
  command: systemctl list-unit-files tailscaled.service
  register: ts_unit
  changed_when: false
  failed_when: false

- name: Enable and start tailscaled if unit exists
  when: ts_unit.rc == 0
  systemd:
    name: tailscaled.service
    enabled: true
    state: started

- name: Show tailscale version (if installed)
  command: tailscale version
  register: ts_ver
  changed_when: false
  failed_when: false

- name: Tailscale install status
  debug:
    msg:
      - "tailscale apt install rc={{ ts_install.rc | default('n/a') }}"
      - "tailscaled unit present={{ (ts_unit.rc == 0) }}"
      - "tailscale version={{ ts_ver.stdout | default('not installed') }}"
      - "To join: sudo tailscale up"
