- name: Check if tailscale is installed
  command: tailscale version
  register: ts_ver
  failed_when: false
  changed_when: false

- name: Install tailscale (official script) if missing
  when: ts_ver.rc != 0
  shell: |
      set -e
      curl -fsSL https://tailscale.com/install.sh | sh
  args:
      executable: /bin/bash

- name: Enable and start tailscaled
  systemd:
      name: tailscaled
      enabled: true
      state: started

- name: Reminder to join tailscale
  debug:
      msg:
          - "Tailscale installed and tailscaled started."
          - "Join the tailnet manually on the server: sudo tailscale up"
          - "Or use an auth key: sudo tailscale up --auth-key <key>"
